<div class="message-wrapper" [class.user-message]="message.type === 'user'" [class.ai-message]="message.type === 'ai'">
  <div class="message-bubble">
    <div class="message-content">
      @if (message.type === 'ai') {
        <span #messageText class="word-container">
          @for (word of words; track $index) {
            <span 
              class="word" 
              [class.highlighted]="isWordHighlighted($index)"
              (click)="onWordClick($index)"
            >{{ word }}</span>{{ ' ' }}
          }
        </span>
      } @else {
        <span>{{ displayedText || message.content }}</span>
      }
    </div>
    <img *ngIf="message.image" [src]="message.image" alt="Uploaded image" class="message-image" />
    
    <!-- Playback controls and timestamp for AI messages -->
    @if (message.type === 'ai') {
      <div class="playback-controls">
        <button class="icon-button" (click)="togglePlay()" aria-label="Play or stop readout">
          <i class="fa-solid" [class.fa-stop]="playing" [class.fa-play]="!playing" aria-hidden="true"></i>
        </button>
        <div class="message-timestamp">
          {{ message.timestamp | date: 'short' }}
        </div>
      </div>
    } @else {
      <div class="message-timestamp">
        {{ message.timestamp | date: 'short' }}
      </div>
    }
  </div>
</div>
